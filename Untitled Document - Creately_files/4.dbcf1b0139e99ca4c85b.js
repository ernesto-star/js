(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{PDpc:function(e,t,n){"use strict";n.d(t,"a",(function(){return C}));var r=n("D57K"),i=n("Jzy8"),o=n("W9bu"),a=n("g3Dv"),c=n("19Zn"),s=n("SKSx"),u=n("5xGT"),h=n("fQLH"),p=n("gQst"),d=n("iUUs"),l=n("d9YI"),m=n("AouM"),f=n("U3QC"),g=n("z5yO"),b=n("w1VY"),v=n("QoSw"),y=n("flPR"),O=n("sXdR"),C=function(e){function t(t,n,r,i){var o=e.call(this,n)||this;return o.ll=t,o.state=n,o.linkService=r,o.diagToViewport=i,o._indicators=[],o.addSource=new h.a,o.removeSource=new h.a,o.changeSource=new h.a,o}return r.d(t,e),t.prototype.initialize=function(){var e=this,t=this.state.changes("InterfaceControlState").pipe(Object(m.a)((function(t){return e.removeIndicators(),"edit"===t?e.initForEditor():e.initForViewer()})));this.subs.push(t.subscribe())},t.prototype.initForViewer=function(){var e=this;return Object(p.a)(this.addIndicators().pipe(Object(m.a)((function(){return e.handleClick()}))),this.listenToViewportChanges().pipe(Object(O.lodashThrottle)(300,{leading:!1,trailing:!0}),Object(f.a)((function(){return e.updateIndicators()}))))},t.prototype.initForEditor=function(){var e=this;return Object(p.a)(this.hyperlinkKeyEvent("keydown").pipe(Object(O.lodashThrottle)(300,{leading:!0,trailing:!1}),Object(m.a)((function(){return e.addIndicators()})),Object(m.a)((function(){return e.handleClick()}))),this.hyperlinkKeyEvent("keyup").pipe(Object(f.a)((function(){return e.removeIndicators()}))),this.listenToViewportChanges().pipe(Object(f.a)((function(){return e.removeIndicators()}))))},t.prototype.updateIndicators=function(){var e=this;this._indicators.forEach((function(t){e.positionIndicator(t),e.changeSource.next(t)}))},t.prototype.addIndicators=function(){var e=this;return this.ll.forCurrent(!0).getDiagramOnce().pipe(Object(f.a)((function(t){Object.keys(t.shapes).forEach((function(n){var r=t.shapes[n];r.getTextsWithHyperlinks().forEach((function(t){var n=new u.bb(0,0,t.width,t.height),i=e.getPoint(r,t),o=new s.a(t,i),a=c.B.getPointOnText(n,t.alignX,t.alignY);o.regX=a.x,o.regY=a.y,o.rotation=r.transform?r.transform.angle:0,e.positionIndicator(o),e._indicators.push(o),e.addSource.next(o)}))}))})))},t.prototype.getPoint=function(e,t){var n;if(e.isConnector()){var r=e;n=c.B.getPointOnConnector(r,t)}else{var i=e;n=c.B.getPointOnShape(t.position,i.defaultBounds,i.transform)}return n},t.prototype.handleClick=function(){var e=this;if(this.indicators.length>0){var t=this.indicators.map((function(t){var n=t.children.map((function(t){return Object(d.a)(t,"click").pipe(Object(f.a)((function(){return e.navigate(t)})))}));return p.a.apply(void 0,r.j(n))}));return p.a.apply(void 0,r.j(t))}return Object(l.b)()},t.prototype.navigate=function(e){this.linkService.navigate(i.q.fromUrl(e.value))},t.prototype.hyperlinkKeyEvent=function(e){return Object(d.a)(window,e).pipe(Object(g.a)((function(e){return e.keyCode===a.f.Command||e.keyCode===a.f.Control})))},t.prototype.positionIndicator=function(e){e.x=this.diagToViewport.x(e.origin.x),e.y=this.diagToViewport.y(e.origin.y);var t=this.state.get("DiagramZoomLevel");e.scaleX=t,e.scaleY=t},t.prototype.listenToViewportChanges=function(){return Object(p.a)(this.state.changes("DiagramPan"),this.state.changes("DiagramZoomLevel"))},t.prototype.removeIndicators=function(){for(;this._indicators.length>0;)this.removeSource.next(this._indicators.pop())},Object.defineProperty(t.prototype,"indicators",{get:function(){return this._indicators},enumerable:!0,configurable:!0}),t.prototype.createAddSource=function(){return this.addSource},t.prototype.createRemoveSource=function(){return this.removeSource},t.prototype.createChangeSource=function(){return this.changeSource},t=r.c([Object(y.a)(),r.f("design:paramtypes",[v.a,u.kb,o.a,b.a])],t)}(y.b)},f6YR:function(e,t,n){"use strict";var r=n("D57K"),i=n("5xGT"),o=n("hX56"),a=n("nsO7"),c=n("fQLH"),s=n("gQst"),u=n("pN2L"),h=n("iUUs"),p=n("d9YI"),d=n("U3QC"),l=n("AouM"),m=n("Jg5f"),f=n("lqvn"),g=n("HswR"),b=n("z5yO"),v=n("O6K7"),y=n("yn08"),O=n("w1VY"),C=n("Wpmq"),S=n("QoSw"),I=n("3+4Q"),j=n("flPR"),w=n("h1tj"),x=function(e){function t(t){var n=e.call(this)||this;return n.model=t,n.prepare(),n}return r.d(t,e),t.prototype.destroy=function(){},t.prototype.prepare=function(){var e=new w.Shape;e.graphics.clear(),e.graphics.beginFill(this.model.resolved?t.RESOLVED_ICON_COLOR:t.ICON_COLOR),e.graphics.beginStroke("#FFFFFF"),e.graphics.setStrokeStyle(2),e.graphics.drawCircle(0,0,15),e.graphics.endStroke(),e.graphics.endFill(),e.shadow=new w.Shadow("rgba(0, 0, 0, 0.25)",0,2,3),this.addChild(e);var n=new w.Bitmap('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="22.84" height="17.07"><path fill="rgb(255, 255, 255)" d="M22.84,7.46C22.84,3.34,17.73,0,11.42,0S0,3.34,0,7.46s5.11,7.46,11.42,7.46a17.57,17.57,0,0,0,3.21-.3l4.3,2.43a.17.17,0,0,0,.25-.15l0-3.95C21.42,11.59,22.84,9.63,22.84,7.46Z" /></svg>');n.scaleX=.8,n.scaleY=.8,n.x=-9,n.y=-6,this.addChild(n)},t.ICON_COLOR="#F39C12",t.RESOLVED_ICON_COLOR="#7e7e7e",t}(w.Container),T=n("4y1S");n.d(t,"a",(function(){return k}));var k=function(e){function t(t,n,r,i,o,a,s){var u=e.call(this,n)||this;return u.ll=t,u.state=n,u.datastore=r,u.commandService=i,u.diagToViewport=o,u.viewToDiagram=a,u.userLocator=s,u.addSource=new c.a,u.removeSource=new c.a,u.changeSource=new c.a,u.shapeComments={},u.diagramComments={},u}var n;return r.d(t,e),n=t,t.prototype.initialize=function(){var e=this;this.subs.push(this.state.changes("CurrentDiagram").pipe(Object(d.a)((function(){e.hideCommentThreadView(),e.removeAllIndicators()})),Object(l.a)((function(){return Object(s.a)(e.listenToCreateEvents(),e.listenToSingleCommentInsertChanges(),e.listenToCommentUpdateChanges(),e.listenToOpenPanelChanges().pipe(Object(l.a)((function(t){return e.userLocator.getCommentToggleState().pipe(Object(l.a)((function(n){return t||n?Object(s.a)(e.listenToCommentInsertChanges(),e.listenToViewportChanges(),e.listenToDiagramChanges(),e.listenToResolvedCommentChanges()):(e.hideCommentThreadView(),e.removeAllIndicators())})))}))))}))).subscribe())},Object.defineProperty(t.prototype,"indicators",{get:function(){return r.j(Object(a.values)(this.diagramComments),Object(a.flatten)(Object(a.values)(this.shapeComments).map((function(e){return Object(a.values)(e)}))))},enumerable:!0,configurable:!0}),t.prototype.createAddSource=function(){return this.addSource},t.prototype.createRemoveSource=function(){return this.removeSource},t.prototype.createChangeSource=function(){return this.changeSource},Object.defineProperty(t.prototype,"locator",{get:function(){return this.ll.forCurrent(!0)},enumerable:!0,configurable:!0}),t.prototype.listenToOpenPanelChanges=function(){return this.state.changes(n.SIDEBAR_STATE_KEY).pipe(Object(m.a)((function(e){return e===n.SIDEBAR_STATE_VAL})),Object(f.a)())},t.prototype.listenToCommentInsertChanges=function(){var e=this,t=this.state.get("CurrentDiagram");return Object(s.a)(this.datastore.findLatest(I.a,{diagramId:t}).pipe(Object(m.a)((function(e){return{type:"insert",docs:e}}))),this.datastore.watch(I.a,{diagramId:t}).pipe(Object(g.a)((function(e){return e.docs?i.y.build({docs:I.a},e):Object(u.a)(e)})))).pipe(Object(b.a)((function(e){return"insert"===e.type})),Object(d.a)((function(t){t.docs.filter((function(e){return!e.parentId&&!e.resolved})).forEach((function(t){return e.createCommentIndicator(t)}))})))},t.prototype.listenToCommentUpdateChanges=function(){var e=this,t=this.state.get("CurrentDiagram");return Object(s.a)(this.datastore.findLatest(I.a,{diagramId:t}).pipe(Object(m.a)((function(e){return{type:"insert",docs:e}}))),this.datastore.watch(I.a,{diagramId:t}).pipe(Object(g.a)((function(e){return e.docs?i.y.build({docs:I.a},e):Object(u.a)(e)})))).pipe(Object(b.a)((function(e){return"update"===e.type})),Object(d.a)((function(t){t.docs.filter((function(e){return e.resolved})).forEach((function(t){e.removeCommentIndicator(t),e.singleComment&&t.id===e.singleComment.id&&(e.singleComment=null)}))})))},t.prototype.listenToViewportChanges=function(){var e=this;return Object(s.a)(this.state.changes("DiagramPan"),this.state.changes("DiagramZoomLevel")).pipe(Object(l.a)((function(){return e.locator.getDiagramOnce()})),Object(d.a)((function(t){return e.updateIndicatorPositions(t)})))},t.prototype.listenToDiagramChanges=function(){var e=this;return this.locator.getDiagramChanges().pipe(Object(d.a)((function(t){var n,i,o,a;if(t.split.shapes)try{for(var c=r.k(Object.keys(t.split.shapes)),s=c.next();!s.done;s=c.next()){var u=s.value;if(e.shapeComments[u])try{for(var h=(o=void 0,r.k(Object.keys(e.shapeComments[u]))),p=h.next();!p.done;p=h.next()){var d=p.value,l=e.shapeComments[u][d];e.positionShapeCommentIndicator(l,t.model.shapes[u]),e.changeSource.next(l)}}catch(m){o={error:m}}finally{try{p&&!p.done&&(a=h.return)&&a.call(h)}finally{if(o)throw o.error}}}}catch(f){n={error:f}}finally{try{s&&!s.done&&(i=c.return)&&i.call(c)}finally{if(n)throw n.error}}})))},t.prototype.listenToCreateEvents=function(){var e=this;return Object(h.a)(this.indicatorLayer,v.b.CreateComment).pipe(Object(d.a)((function(t){e.showCommentThreadView(t.getShapeId(),t.getPosition()),e.switchToNormalState()})))},t.prototype.listenToResolvedCommentChanges=function(){var e=this;return this.state.changes("CommentThreadData").pipe(Object(d.a)((function(t){e.removeResolvedCommentIndicators(),t.comments&&t.comments.forEach((function(t){!t.parentId&&t.resolved&&e.createCommentIndicator(t)}))})))},t.prototype.removeResolvedCommentIndicators=function(){var e,t,n,i,o,a;try{for(var c=r.k(Object.keys(this.diagramComments)),s=c.next();!s.done;s=c.next()){var u=s.value;!(f=this.diagramComments[u]).model.parentId&&f.model.resolved&&(this.removeSource.next(f),delete this.diagramComments[u])}}catch(g){e={error:g}}finally{try{s&&!s.done&&(t=c.return)&&t.call(c)}finally{if(e)throw e.error}}try{for(var h=r.k(Object.keys(this.shapeComments)),p=h.next();!p.done;p=h.next()){var d=p.value;try{for(var l=(o=void 0,r.k(Object.keys(this.shapeComments[d]))),m=l.next();!m.done;m=l.next()){var f;u=m.value;!(f=this.shapeComments[d][u]).model.parentId&&f.model.resolved&&(this.removeSource.next(f),delete this.shapeComments[d][u])}}catch(b){o={error:b}}finally{try{m&&!m.done&&(a=l.return)&&a.call(l)}finally{if(o)throw o.error}}}}catch(v){n={error:v}}finally{try{p&&!p.done&&(i=h.return)&&i.call(h)}finally{if(n)throw n.error}}},t.prototype.removeAllIndicators=function(){var e,t;try{for(var n=r.k(this.indicators),i=n.next();!i.done;i=n.next()){var o=i.value;this.removeSource.next(o),o.destroy()}}catch(a){e={error:a}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}return this.shapeComments={},this.diagramComments={},Object(p.b)()},t.prototype.updateIndicatorPositions=function(e){var t,n,i,o,a,c;try{for(var s=r.k(Object.keys(this.diagramComments)),u=s.next();!u.done;u=s.next()){var h=u.value,p=this.diagramComments[h];this.positionDiagramCommentIndicator(p),this.changeSource.next(p)}}catch(b){t={error:b}}finally{try{u&&!u.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}try{for(var d=r.k(Object.keys(this.shapeComments)),l=d.next();!l.done;l=d.next()){var m=l.value;try{for(var f=(a=void 0,r.k(Object.keys(this.shapeComments[m]))),g=f.next();!g.done;g=f.next()){h=g.value,p=this.shapeComments[m][h];this.positionShapeCommentIndicator(p,e.shapes[m]),this.changeSource.next(p)}}catch(v){a={error:v}}finally{try{g&&!g.done&&(c=f.return)&&c.call(f)}finally{if(a)throw a.error}}}}catch(y){i={error:y}}finally{try{l&&!l.done&&(o=d.return)&&o.call(d)}finally{if(i)throw i.error}}},t.prototype.listenToSingleCommentInsertChanges=function(){var e=this;return this.state.changes("CommentThreadData").pipe(Object(l.a)((function(t){return e.listenToOpenPanelChanges().pipe(Object(b.a)((function(e){return!e})),Object(l.a)((function(){return t&&t.visible&&t.threadId&&t.comments.length?(e.createSingleCommentIndicator(t.comments[0]),Object(p.b)()):t&&!t.visible?e.userLocator.getCommentToggleState().pipe(Object(f.a)(),Object(m.a)((function(t){!t&&e.singleComment&&e.removeSingleCommentIndicator()}))):Object(p.b)()})))})))},t.prototype.createCommentIndicator=function(e){e.shapeId?this.createShapeCommentIndicator(e):this.createDiagramCommentIndicator(e)},t.prototype.createSingleCommentIndicator=function(e){this.singleComment=e,this.createCommentIndicator(e)},t.prototype.createDiagramCommentIndicator=function(e){if(e.locOnDiagram&&(!this.diagramComments[e.id]||this.diagramComments[e.id].model.resolved!==e.resolved)){var t=new x(e);this.positionDiagramCommentIndicator(t),this.setupCommentInteractions(t),this.diagramComments[e.id]=t,this.addSource.next(t)}},t.prototype.positionDiagramCommentIndicator=function(e){e.x=this.diagToViewport.x(e.model.locOnDiagram.x),e.y=this.diagToViewport.y(e.model.locOnDiagram.y)},t.prototype.createShapeCommentIndicator=function(e){var t=this;this.locator.getShapeOnce(e.shapeId).subscribe((function(n){if(t.shapeComments[e.shapeId]||(t.shapeComments[e.shapeId]={}),!t.shapeComments[e.shapeId][e.id]||t.shapeComments[e.shapeId][e.id].model.resolved!==e.resolved){var r=new x(e);t.positionShapeCommentIndicator(r,n),t.setupCommentInteractions(r),t.shapeComments[e.shapeId][e.id]=r,t.addSource.next(r)}}))},t.prototype.positionShapeCommentIndicator=function(e,t){if(!t)return this.positionDiagramCommentIndicator(e);var n=i.U.onRect(e.model.locOnShape,t.defaultBounds,t.transform);e.x=this.diagToViewport.x(n.x),e.y=this.diagToViewport.y(n.y)},t.prototype.removeCommentIndicator=function(e){var t=this.indicators.find((function(t){return t.model.id===e.id}));this.removeSource.next(t),this.hideCommentThreadView()},t.prototype.removeSingleCommentIndicator=function(){var e,t,n=this,i=this.singleComment.id,o=this.indicators.find((function(e){return e.model.id===n.singleComment.id}));if(this.removeSource.next(o),this.singleComment=null,this.diagramComments[i])delete this.diagramComments[i];else try{for(var a=r.k(Object.keys(this.shapeComments)),c=a.next();!c.done;c=a.next()){var s=c.value;this.shapeComments[s][i]&&delete this.shapeComments[s][i]}}catch(u){e={error:u}}finally{try{c&&!c.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}},t.prototype.setupCommentInteractions=function(e){var t=this;this.subs.push(Object(h.a)(e,"click").subscribe((function(){i.mb.track("right.comment.show",{value1Type:"trigger",value1:"canvas"});var n=e.model,r={visible:!0,threadId:n.id,comments:[n]};t.state.set("CommentThreadData",r)})))},t.prototype.showCommentThreadView=function(e,t){var n={visible:!0,shapeId:e,position:{x:this.viewToDiagram.x(t.x),y:this.viewToDiagram.y(t.y)}};this.state.set("CommentThreadData",n)},t.prototype.switchToNormalState=function(){this.state.set("MouseControlState",y.b.Normal)},t.prototype.hideCommentThreadView=function(){this.state.set("CommentThreadData",{})},t.SIDEBAR_STATE_KEY="RightSidebarPanel",t.SIDEBAR_STATE_VAL="diagramcomments",t=n=r.c([Object(j.a)(),r.f("design:paramtypes",[S.a,i.kb,o.b,i.q,O.a,C.a,T.m])],t)}(j.b)},jDMA:function(e,t,n){"use strict";var r=n("D57K"),i=n("qMyy"),o=n("5xGT"),a=n("nsO7"),c=n("fQLH"),s=n("gQst"),u=n("pN2L"),h=n("d9YI"),p=n("mUyW"),d=n("z5yO"),l=n("AouM"),m=n("U3QC"),f=n("G2Mx"),g=n("4HYP"),b=n("Jg5f"),v=n("w1VY"),y=n("7zx0"),O=n("flPR"),C=n("h1tj"),S=function(e){function t(t,n){var r=e.call(this)||this;return r.peerId=t,r.user=n,r.onChange=function(){return null},r.prepare(),r}return r.d(t,e),t.prototype.destroy=function(){},t.prototype.animate=function(e,n,r){void 0===r&&(r=t.ANIMATION_DURATION),C.Tween.get(this,{override:!0,onChange:this.onChange}).to({x:e,y:n},r,C.Ease.linear)},t.prototype.prepare=function(){var e=new C.Shape;e.graphics.clear(),e.graphics.beginFill(this.user.displayColor),e.graphics.moveTo(0,0),e.graphics.lineTo(3,12),e.graphics.lineTo(4,4),e.graphics.lineTo(12,3),e.graphics.lineTo(0,0),e.graphics.endFill();var t=new C.Text(this.user.fullName,"12px Arial","#fff");t.x=12,t.y=12;var n=new C.Shape,r=t.getMeasuredWidth()+12,i=t.getMeasuredHeight()+12;n.graphics.beginFill(this.user.displayColor),n.graphics.drawRect(6,6,r,i),n.graphics.endFill(),this.addChild(e),this.addChild(n),this.addChild(t)},t.ANIMATION_DURATION=200,t}(C.Container),I=n("wkcE");n.d(t,"a",(function(){return j}));var j=function(e){function t(t,n,r,i,o){var a=e.call(this,t)||this;return a.state=t,a.diagToViewport=n,a.realtimeStates=r,a.commandService=i,a.collabLocator=o,a.addSource=new c.a,a.removeSource=new c.a,a.changeSource=new c.a,a.pointers={},a.pointerData={},a}var n;return r.d(t,e),n=t,t.prototype.initialize=function(){var e=this;this.subs.push(this.state.changes("RealtimeConnectionStatus").pipe(Object(d.a)((function(e){return e===y.a.ONLINE})),Object(l.a)((function(){return e.state.changes("CurrentDiagram").pipe(Object(m.a)((function(){e.removeAllIndicators()})),Object(l.a)((function(){return Object(s.a)(e.listenToViewportChanges(),e.listenToRealtimePointerStates(),e.listenToRealtimeSelectedStates(),e.listenToAddedPeers(),e.listenToCleanupInterval(),e.listenToRemovedPeers())})))}))).subscribe())},Object.defineProperty(t.prototype,"indicators",{get:function(){return Object(a.values)(this.pointers)},enumerable:!0,configurable:!0}),t.prototype.createAddSource=function(){return this.addSource},t.prototype.createRemoveSource=function(){return this.removeSource},t.prototype.createChangeSource=function(){return this.changeSource},t.prototype.listenToRealtimeSelectedStates=function(){var e=this;return this.realtimeStates.get(n.KEY_SELECTED).pipe(Object(m.a)((function(t){var n=JSON.parse(t.value),r=e.state.get("Selected").filter((function(e){return n.includes(e)}));r.length&&e.commandService.dispatch(i.a.selectShapes,{shapeIds:r,remove:!0}),e.updateSelectionBlockState(t.userId,n)})))},t.prototype.listenToAddedPeers=function(){var e=this;return this.realtimeStates.addedPeers().pipe(Object(l.a)((function(t){return e.realtimeStates.get(n.KEY_POINTERS).pipe(Object(d.a)((function(e){return e.peerId===t})),Object(f.a)(1))})),Object(m.a)((function(){e.realtimeStates.set("selected",JSON.stringify(e.state.get("Selected")))})))},t.prototype.updateSelectionBlockState=function(e,t){var n=this.state.get("SelectionBlocked"),r=n.find((function(t){return t.userId===e}));r?(r.selected=t,this.state.set("SelectionBlocked",n)):(n.push({userId:e,selected:t}),this.state.set("SelectionBlocked",n))},t.prototype.listenToRealtimePointerStates=function(){var e=this;return this.realtimeStates.get(n.KEY_POINTERS).pipe(Object(g.a)((function(t){var n=Boolean(e.pointerData[t.peerId]);return e.pointerData[t.peerId]=JSON.parse(t.value),e.pointerTime[t.peerId]=Date.now(),e.pointers[t.peerId]?Object(u.a)(e.pointers[t.peerId]):n?Object(h.b)():e.collabLocator.getCollab(t.userId).pipe(Object(d.a)((function(e){return null!==e})),Object(f.a)(1),Object(b.a)((function(n){return e.createRealtimePointerIndicator(n,t.peerId)})))})),Object(m.a)((function(t){e.updateRealtimePointerIndicator(t)})))},t.prototype.listenToViewportChanges=function(){var e=this;return Object(s.a)(this.state.changes("DiagramPan"),this.state.changes("DiagramZoomLevel")).pipe(Object(m.a)((function(){return e.updateIndicatorPositions()})))},t.prototype.listenToCleanupInterval=function(){var e=this;return Object(p.a)(n.TIME_INACTIVE).pipe(Object(m.a)((function(){return e.removeOldIndicators()})))},t.prototype.listenToRemovedPeers=function(){var e=this;return this.realtimeStates.removedPeers().pipe(Object(m.a)((function(t){return e.removeIndicator(t)})))},t.prototype.removeIndicator=function(e){var t=this.pointers[e];t&&this.updateSelectionBlockState(t.user.id,[]);var n=this.indicators.findIndex((function(e){return e===t}));return this.indicators.splice(n,1),this.removeSource.next(t),delete this.pointers[e],delete this.pointerData[e],delete this.pointerTime[e],Object(h.b)()},t.prototype.removeAllIndicators=function(){var e,t;try{for(var n=r.k(this.indicators),i=n.next();!i.done;i=n.next()){var o=i.value;this.removeSource.next(o),o.destroy()}}catch(a){e={error:a}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}return this.pointers={},this.pointerData={},this.pointerTime={},Object(h.b)()},t.prototype.removeOldIndicators=function(){var e,t,i=Date.now()-n.TIME_INACTIVE;try{for(var o=r.k(Object.entries(this.pointerTime)),a=o.next();!a.done;a=o.next()){var c=r.h(a.value,2),s=c[0];c[1]<i&&this.removeIndicator(s)}}catch(u){e={error:u}}finally{try{a&&!a.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}return Object(h.b)()},t.prototype.updateIndicatorPositions=function(){var e,t;try{for(var n=r.k(Object.keys(this.pointers)),i=n.next();!i.done;i=n.next()){var o=i.value,a=this.pointers[o];this.updateRealtimePointerIndicator(a)}}catch(c){e={error:c}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},t.prototype.createRealtimePointerIndicator=function(e,t){var n=this,r=new S(t,e);return this.pointers[t]=r,this.addSource.next(r),r.onChange=function(){return n.changeSource.next(r)},this.updateRealtimePointerIndicator(r,!1),r},t.prototype.updateRealtimePointerIndicator=function(e,t){void 0===t&&(t=!0);var n=this.pointerData[e.peerId],r=this.diagToViewport.x(n[0]),i=this.diagToViewport.y(n[1]);t?e.animate(r,i):(e.x=r,e.y=i)},t.KEY_POINTERS="pointer",t.KEY_SELECTED="selected",t.TIME_INACTIVE=6e4,t=n=r.c([Object(O.a)(),r.f("design:paramtypes",[o.kb,v.a,y.b,o.q,I.a])],t)}(O.b)},tHMF:function(e,t,n){"use strict";var r=n("D57K"),i=n("W9bu"),o=n("g3Dv"),a=n("wx9+"),c=n("h1tj"),s=function(e){function t(){var n=e.call(this)||this;n.animationDuration=30,n.onChange=function(){return null},n.textPadding=5,n.text=new c.Text("Ctrl + Click to open link","12px Arial","#7E7E7E"),n.textRect=new c.Shape;var r=n.text.getMeasuredWidth()+2*n.textPadding,i=n.text.getMeasuredHeight()+2*n.textPadding;return n.clickableRect=new c.Shape,n.clickableRect.name=t.clickableRectName,n.clickableRect.alpha=0,n.textRect.graphics.clear().setStrokeStyle(1).beginStroke("#ECECEC").beginFill("#fff").drawRect(0,0,r,i).endFill(),n.textRect.setBounds(0,0,r,i),n.text.setBounds(0,0,n.text.getMeasuredWidth(),n.text.getMeasuredHeight()),n.circle=new c.Shape,n.addChild(n.circle),n.addChild(n.textRect),n.addChild(n.text),n.addChild(n.clickableRect),n.circle.graphics.clear(),n.circle.graphics.beginFill(t.ICON_COLOR),n.circle.graphics.beginStroke("#FFFFFF"),n.circle.graphics.setStrokeStyle(2),n.circle.graphics.drawCircle(0,0,5),n.circle.graphics.endStroke(),n.circle.graphics.endFill(),n.circle.shadow=new c.Shadow("rgba(0, 0, 0, 0.25)",0,2,3),n}return r.d(t,e),t.prototype.destroy=function(){},t.prototype.update=function(e,t){this.bounds=e,this.link=t,this.circle.x=e.right,this.circle.y=e.bottom,this.text.x=e.centerX-this.text.getBounds().width/2,this.text.y=e.bottom+this.textPadding+15,this.clickableRect.graphics.clear().beginFill("rgba(0,0,0,0.01)").drawRect(0,0,e.width,e.height).endFill(),this.clickableRect.x=e.x,this.clickableRect.y=e.y,this.textRect.x=e.centerX-this.textRect.getBounds().width/2,this.textRect.y=e.bottom+15,this.setVisibilty([this.text,this.textRect],!1)},t.prototype.toggleInfo=function(e){var t=this.text.isVisible()&&this.textRect.isVisible();if(this.bounds){var n=this.bounds.contains({x:e.x,y:e.y,width:0,height:0});!t&&n&&this.setVisibilty([this.text,this.textRect],!0),t&&!n&&this.setVisibilty([this.text,this.textRect],!1)}},t.prototype.setVisibilty=function(e,t){var n=this;e.forEach((function(e){return c.Tween.get(e,{override:!0,onChange:n.onChange}).to({alpha:t?1:0,visible:t},n.animationDuration)}))},Object.defineProperty(t.prototype,"clickable",{set:function(e){this.clickableRect.alpha=e?1:0},enumerable:!0,configurable:!0}),t.ICON_COLOR="#5B7AEA",t.clickableRectName="clickableRect",t}(c.Container),u=n("5xGT"),h=n("fQLH"),p=n("gQst"),d=n("iUUs"),l=n("AouM"),m=n("U3QC"),f=n("Jg5f"),g=n("G2Mx"),b=n("z5yO"),v=n("QoSw"),y=n("flPR"),O=n("nsO7"),C=n("sXdR");n.d(t,"a",(function(){return S}));var S=function(e){function t(t,n,r,i){var o=e.call(this,i)||this;return o.linkService=t,o.viewport=n,o.ll=r,o.state=i,o._indicators={},o.addSource=new h.a,o.removeSource=new h.a,o.changeSource=new h.a,o}return r.d(t,e),t.prototype.initialize=function(){var e=this,t=this.state.changes("InterfaceControlState").pipe(Object(l.a)((function(){return e.removeIndicators(),e.init()})));this.subs.push(t.subscribe(),this.handleVisibility().subscribe(),this.handleKeyDown().subscribe(),this.handleKeyUp().subscribe(),this.handleClick().subscribe(),this.pointerMove().subscribe((function(t){e.indicators.forEach((function(e){return e.toggleInfo(t)}))})))},t.prototype.init=function(){var e=this;return Object(p.a)(this.ll.forCurrentObserver(!0).pipe(Object(l.a)((function(e){return e.getDiagramModel()})),Object(l.a)((function(t){return e.manageIndicators(t)}))),this.viewport.getShapeModels().pipe(Object(l.a)((function(t){return e.updateIndicators(t)}))))},t.prototype.handleKeyDown=function(){var e=this;return this.getKeyEvent("keydown").pipe(Object(m.a)((function(){return e.indicators.forEach((function(t){t.clickable=!0,e.changeSource.next(t)}))})))},t.prototype.handleKeyUp=function(){var e=this;return this.getKeyEvent("keyup").pipe(Object(m.a)((function(){return e.indicators.forEach((function(t){t.clickable=!1,e.changeSource.next(t)}))})))},t.prototype.handleClick=function(){var e=this;return Object(d.a)(this.indicatorLayer,"click").pipe(Object(m.a)((function(t){if(t.target&&t.target.name===s.clickableRectName){var n=t.target.parent;n.link&&e.linkService.navigate(n.link)}})))},Object.defineProperty(t.prototype,"visible",{set:function(e){this.indicators.forEach((function(t){return t.visible=e}))},enumerable:!0,configurable:!0}),t.prototype.handleVisibility=function(){var e=this;return this.state.changes("Selected").pipe(Object(l.a)((function(t){return e.ll.forCurrentObserver(!0).pipe(Object(l.a)((function(e){return e.getDiagramModel()})),Object(f.a)((function(e){return{ids:t,diagram:e}})))})),Object(m.a)((function(t){var n=t.ids,r=t.diagram;if(0===n.length)e.indicators.forEach((function(t){t.circle.visible=!0,e.changeSource.next(t)}));else if(1===n.length){(i=e._indicators[n[0]])&&(i.circle.visible=!1,e.changeSource.next(i))}else if(n.length>1&&r.isShapeInGroup(n)){var i,o=r.getGroupHierarchy(n[0])[0];(i=e._indicators[o])&&(i.circle.visible=!1,e.changeSource.next(i))}})))},t.prototype.pointerMove=function(e){return void 0===e&&(e=200),Object(d.a)(this.indicatorLayer.canvas,"mousemove").pipe(Object(C.lodashThrottle)(e,{leading:!0,trailing:!0}),Object(f.a)((function(e){return{x:e.x,y:e.y}})))},t.prototype.manageIndicators=function(e){var t=this,n=[];for(var i in e.groups){e.groups[i].link&&n.push(i)}return this.viewport.getShapeModels().pipe(Object(g.a)(1),Object(m.a)((function(e){var i=Object(O.values)(e).filter((function(e){return e.link})).map((function(e){return e.id})),o=r.j(n,i);t.manageIndicatorsRemove(o),t.manageIndicatorsAdd(o)})))},t.prototype.manageIndicatorsRemove=function(e){var t=this;Object.keys(this._indicators).forEach((function(n){e.includes(n)||t.removeIndicator(n)}))},t.prototype.removeIndicators=function(){var e=this;Object.keys(this._indicators).forEach((function(t){return e.removeIndicator(t)})),this._indicators={}},t.prototype.removeIndicator=function(e){var t=this._indicators[e];this.removeSource.next(t),delete this._indicators[e]},t.prototype.manageIndicatorsAdd=function(e){var t=this;e.forEach((function(e){t._indicators[e]||(t._indicators[e]=new s,t._indicators[e].onChange=function(){return t.changeSource.next(t._indicators[e])},t.addSource.next(t._indicators[e]))}))},t.prototype.updateIndicators=function(e){var t=this;return this.ll.forCurrentObserver(!0).pipe(Object(l.a)((function(e){return e.getDiagramOnce()})),Object(m.a)((function(n){Object.keys(t._indicators).forEach((function(r){var i=e[r];if(i){var o=t._indicators[r],a=i.bounds;o.update(a,i.link),t.changeSource.next(o)}else if(n.groups[r]){o=t._indicators[r];var c=n.groups[r],s=c.shapes.map((function(t){return e[t]})),u=s[0].bounds;s.forEach((function(e,t){t>0&&u.absorb(e.bounds)})),o.update(u,c.link),t.changeSource.next(o)}}))})))},t.prototype.getKeyEvent=function(e){return Object(d.a)(window,e).pipe(Object(b.a)((function(e){return e.keyCode===o.f.Command||e.keyCode===o.f.Control})))},Object.defineProperty(t.prototype,"indicators",{get:function(){return Object(O.values)(this._indicators)},enumerable:!0,configurable:!0}),t.prototype.createAddSource=function(){return this.addSource},t.prototype.createRemoveSource=function(){return this.removeSource},t.prototype.createChangeSource=function(){return this.changeSource},t=r.c([Object(y.a)(),r.f("design:paramtypes",[i.a,a.a,v.a,u.kb])],t)}(y.b)},"wp/b":function(e,t,n){"use strict";var r=n("D57K"),i=n("h1tj"),o=function(e){function t(){var t=e.call(this)||this;return t.onChange=function(){return null},t.shape=new i.Shape,t.addChild(t.shape),t}return r.d(t,e),t.prototype.destroy=function(){},t.prototype.initDraw=function(e){this.shape.alpha=1,this.shape.visible=!0,this.shape.graphics.clear().setStrokeStyle(t.thickness).beginStroke(t.color).drawRect(0,0,e.width,e.height).endStroke(),this.updatePosition(e),this.animate()},t.prototype.updatePosition=function(e){this.shape.x=e.x,this.shape.y=e.y},t.prototype.animate=function(){i.Tween.get(this.shape,{override:!0,onChange:this.onChange}).to({alpha:0,visible:!1},t.animationDuration)},t.animationDuration=2e3,t.color="#F6AA00",t.thickness=2,t}(i.Container),a=n("wx9+"),c=n("5xGT"),s=n("fQLH"),u=n("0cIN"),h=n("d9YI"),p=n("lqvn"),d=n("AouM"),l=n("z5yO"),m=n("mhnT"),f=n("W/Ou"),g=n("QagP"),b=n("U3QC"),v=n("Jg5f"),y=n("QoSw"),O=n("flPR"),C=n("nsO7");n.d(t,"a",(function(){return S}));var S=function(e){function t(t,n,r){var i=e.call(this,r)||this;return i.viewport=t,i.ll=n,i.state=r,i.addSource=new s.a,i.removeSource=new s.a,i.changeSource=new s.a,i}return r.d(t,e),t.prototype.initialize=function(){var e=this,t=this.state.changes("InterfaceControlState").pipe(Object(p.a)(C.isEqual),Object(d.a)((function(t){return e.removeIndicator(),e.init()})));this.subs.push(t.subscribe())},Object.defineProperty(t.prototype,"visible",{set:function(e){this.indicators.forEach((function(t){return t.visible=e}))},enumerable:!0,configurable:!0}),t.prototype.init=function(){var e=this;return this.state.changes("ShapelinkTarget").pipe(Object(l.a)((function(e){return e.shapeId||e.groupId})),Object(d.a)((function(t){return e.addIndicator(),e.getBounds(t).pipe(Object(m.a)(Object(u.a)(o.animationDuration)),Object(f.a)(null),Object(g.a)(),Object(b.a)((function(t){var n=r.h(t,2),i=n[0],o=n[1];null===i?(e._indicator.initDraw(o),e.changeSource.next(e._indicator)):(e._indicator.updatePosition(o),e.changeSource.next(e._indicator))})))})))},t.prototype.getBounds=function(e){var t=this;return e.shapeId?this.viewport.getShapeModel(e.shapeId).pipe(Object(v.a)((function(e){return e.bounds}))):e.groupId?this.ll.forCurrentObserver(!0).pipe(Object(d.a)((function(e){return e.getDiagramOnce()})),Object(d.a)((function(n){if(n.groups[e.groupId]){var r=n.getShapesInGroup(e.groupId);return t.viewport.getShapeModels(r).pipe(Object(v.a)((function(e){var t=Object(C.values)(e),n=t[0].bounds;return t.forEach((function(e){n.absorb(e.bounds)})),n})))}return Object(h.b)()}))):void 0},t.prototype.addIndicator=function(){var e=this;this._indicator||(this._indicator=new o,this.addSource.next(this._indicator),this._indicator.onChange=function(){return e.changeSource.next(e._indicator)})},t.prototype.removeIndicator=function(){this._indicator&&(this.removeSource.next(this._indicator),this._indicator=null)},Object.defineProperty(t.prototype,"indicators",{get:function(){return[this._indicator]},enumerable:!0,configurable:!0}),t.prototype.createAddSource=function(){return this.addSource},t.prototype.createRemoveSource=function(){return this.removeSource},t.prototype.createChangeSource=function(){return this.changeSource},t=r.c([Object(O.a)(),r.f("design:paramtypes",[a.a,y.a,c.kb])],t)}(O.b)}}]);
//# sourceMappingURL=4.dbcf1b0139e99ca4c85b.js.map